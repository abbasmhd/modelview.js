/**
*
*   ModelView.js
*   @version: 0.60
*   @built on 2015-04-14 12:44:02
*
*   A simple/extendable MV* (MVVM) framework
*   optionaly integrates into both jQuery as MVVM plugin and jQueryUI as MVC widget
*   https://github.com/foo123/modelview.js
*
**/!function(e,t,n){"use strict";var r,i="object"==typeof module&&module.exports,l="function"==typeof define&&define.amd;i?module.exports=(module.$deps=module.$deps||{})[t]=module.$deps[t]||n.call(e,{NODE:module})||1:l&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(t,r,i){return n.call(e,{AMD:i})}):t in e||(e[t]=r=n.call(e,{})||1)&&l&&define(t,[],function(){return r})}(this,"ModelView",function(e){"use strict";function t(e,t){var n=[e||"",Wt];return t&&(n=n.concat(t)),n.join(".")}function n(e){return-1<Jt.indexOf(e)}function r(e,t){return e===t}function i(e,t){return e.toLowerCase()===t.tagName.toLowerCase()}function l(e,t){return e===t.id}function o(e,t){return t[Tt](e)}function u(e){var t=this;return t instanceof u?(e&&t.element(e),void(t.$handle=u.Handler.bind(t))):new u(e)}var a=void 0,s=function(e,t){return e.bind(t)},c="prototype",f=Array,d=f[c],h=RegExp,m=Number,p=Object,v=p[c],$=p.create,g=p.keys,y=Function,b=y[c],_=String,k=_[c],w=b.call,E=(s(w,v.toString),s(w,d.slice)),S=function(e,t){return new y(e,t)},V=function(e,t){return e instanceof t},x=function(e){return _(e)},C=1/0,N=(Math.random,function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}),O=function(e,t,n){return e[t]=a,n||delete e[t],e},M=2,L=3,R=4,D=8,j=9,A=16,I=32,P=64,H=128,z=256,F=512,B=1024,U=A|I,q=A|D,W={"[object Array]":A,"[object RegExp]":H,"[object Number]":M,"[object String]":D,"[object Function]":P,"[object Object]":I},X=function(e){var t;return null===e?z:!0===e||!1===e?R:a===e?F:(t=toString.call(e),t=W[t]||B,M===t||e instanceof m?isNaN(e)?L:M:D===t||e instanceof _?1===e.length?j:D:A===t||e instanceof f?A:H===t||e instanceof h?H:P===t||e instanceof y?P:I===t?I:B)},Q=function(e,t){return!!(t&X(e))},K=function(e){return!isNaN(parseFloat(e,10))&&isFinite(e)},J=function(e){return K(e)&&(e=+e,0===e%1&&e>=0)?!0:!1},Y=function(){var e,t,n,r,i,l,o,u=arguments;for(t=u[0]||{},e=u.length,l=1;e>l;l++)if(n=u[l],I===X(n))for(i in n)r=n[i],o=X(r),t[i]=M&o?0+r:q&o?r.slice(0):r;return t},Z="hasOwnProperty",G="getAttribute",et="setAttribute",tt="checked",nt="disabled",rt="selected",it="name",lt="tagName",ot="type",ut="value",at="options",st="selectedIndex",ct="parentNode",ft="style",dt="innerHTML",ht="innerText",mt="textContent",pt=function(){var e,t,n,r,i,l,o,u,a,s,c,f,d=arguments,h=d.length,m="|^",p="|v";if(h){for(r=1,f=[],a=[],u=[],e=h-1;e>=0;e--)o=d[e],u.unshift("f"+e),o.push?(a.unshift(o[1]),o=o[0]):a.unshift(null),c=o.slice(-2),p===c?(s=!0,o=o.slice(0,-2)):m===c?(s=!1,o=o.slice(0,-2)):s=!1,o=o.length?'["'+o.split(".").join('"]["')+'"]':"",t="a"+o,n="b"+o,a[0]&&(t=u[0]+"("+t+")",n=u[0]+"("+n+")"),i=s?""+r:"-"+r,l=s?"-"+r:""+r,f.unshift("("+t+" < "+n+" ? "+i+" : ("+t+" > "+n+" ? "+l+" : 0))"),r<<=1;return S(u.join(","),"return function(a,b) { return ("+f.join(" + ")+"); };").apply(null,a)}return t="a",n="b",i="-1",l="1",f=""+t+" < "+n+" ? "+i+" : ("+t+" > "+n+" ? "+l+" : 0)",S("a,b","return ("+f+");")},vt=function(e){for(var t=0;e=e.previousSibling;)t++;return t},$t=function(e,t){var n=e;if(t)for(;n.parentNode&&n.parentNode!==t;)n=n.parentNode;return vt(n)},gt=function(e,t,n){var r,i=e.childNodes,l=i.length,o=null,u=0,a=0;for(n=n||1;l>u&&(r=i[u++],t!==r.nodeType||(o=r,++a!==n)););return o},yt=function(e){var t,n=e.length,r=n?e[0].nodeValue:"";if(n>1)for(t=1;n>t;t++)r+=e[t].nodeValue;return r},bt=function(e,t){return d.slice.call((t||document).getElementsByTagName(e),0)},_t=function(e,t,n){return!0===n?[(t||document).querySelector(e)]:d.slice.call((t||document).querySelectorAll(e),0)},kt=function(e,t){return Ft(t,"$this::")?_t(t.slice(7),e,1):_t(t,null,1)},wt=function(e){var t,n=document,r=n.createElement("div"),i=n.createDocumentFragment();for(r.innerHTML=e;t=r.firstChild;)i.appendChild(t);return i},Et=function(){var e=document.createElement("div");return"outerHTML"in e?function(e){return e.outerHTML}:function(t){var n=e.cloneNode();return n.appendChild(t.cloneNode(!0)),n.innerHTML}}(),Tt=function(e){return!e||e.matches?"matches":e.matchesSelector?"matchesSelector":e.webkitMatchesSelector?"webkitMatchesSelector":e.mozMatchesSelector?"mozMatchesSelector":e.msMatchesSelector?"msMatchesSelector":e.oMatchesSelector?"oMatchesSelector":void 0}(this.Element?this.Element[c]:null),St=function(e){return document.createTextNode(e||"")},Vt=window.getComputedStyle?function(e){return window.getComputedStyle(e,null)}:function(e){return e.currentStyle},xt=function(e){e._displayCached||(e._displayCached=Vt(e).display||"block"),e[ft].display="none"!==e._displayCached?e._displayCached:"block",e._displayCached=a},Ct=function(e){e._displayCached||(e._displayCached=Vt(e).display||"block"),e[ft].display="none"},Nt=function(e){var t=e.attributes[ut];return!t||t.specified?e[ut]:e.text},Ot=function(e){for(var t,n,r=e[at],i=e[st],l="select-one"===e[ot]||0>i,o=l?null:[],u=l?i+1:r.length,a=0>i?u:l?i:0;u>a;a++)if(n=r[a],!(!n[rt]&&a!==i||n[nt]||n[ct][nt]&&"optgroup"===n[ct][lt])){if(t=Nt(n),l)return t;o.push(t)}return o},Mt=function(e,t){var n,r,i=[].concat(t).map(x),l=e[at];for(r=0;r<l.length;r++)n=l[r],n[rt]=-1<i.indexOf(Nt(n));i.length||(e[st]=-1)},Lt=function(e){if(e)switch(e[lt].toLowerCase()){case"textarea":case"input":return e[ut];case"select":return Ot(e);default:return mt in e?e[mt]:e[ht]}},Rt=function(e,t){if(e)switch(e[lt].toLowerCase()){case"textarea":case"input":e[ut]=_(t);break;case"select":Mt(e,t);break;default:mt in e?e[mt]=_(t):e[ht]=_(t)}},Dt=function(e){return e.length>0},jt=/\s+/g,At=function(e){var t=e.split("."),n=t[0];return t=t.slice(1).filter(Dt),[n,t.sort()]},It=function(e){return e.length?new h("(^|\\.)"+e.join("\\.(?:.*\\.|)")+"(\\.|$)"):!1},Pt=JSON.parse,Ht=JSON.stringify,zt=k.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s+|\s+$/g,"")},Ft=k.startsWith?function(e,t,n){return e.startsWith(t,n||0)}:function(e,t,n){return t===e.slice(n||0,t.length)},Bt=Date.now?Date.now:function(){return(new Date).getTime()},Ut=function(e,t){this.v=e||null,this.n=t||{}},qt="*",Wt="modelview",Xt=0,Qt=function(e){return[e||"UUID",++Xt,Bt()].join("_")};this.Element&&!this.Element[c].addEventListener&&!function(){function e(e,t){Window[c][e]=HTMLDocument[c][e]=Element[c][e]=t}e("addEventListener",function(e,t){var n=this,r=n.addEventListener.listeners=n.addEventListener.listeners||{},i=r[e]=r[e]||[];i.length||(i.event=function(e){var t=n.document&&n.document.documentElement||n.documentElement||{scrollLeft:0,scrollTop:0};e.currentTarget=n,e.pageX=e.clientX+t.scrollLeft,e.pageY=e.clientY+t.scrollTop,e.preventDefault=function(){e.returnValue=!1},e.relatedTarget=e.fromElement||null,e.stopImmediatePropagation=function(){u=!1,e.cancelBubble=!0},e.stopPropagation=function(){e.cancelBubble=!0},e.target=e.srcElement||n,e.timeStamp=+new Date;for(var r,l=0,o=[].concat(i),u=!0;u&&(r=o[l]);++l)for(var a,s=0;a=i[s];++s)if(a==r){a.call(n,e);break}},n.attachEvent?n.attachEvent("on"+e,i.event):n["on"+e]=i.event),i.push(t)}),e("removeEventListener",function(e,t){for(var n,r=this,i=r.addEventListener.listeners=r.addEventListener.listeners||{},l=i[e]=i[e]||[],o=l.length-1;n=l[o];--o)if(n==t){l.splice(o,1);break}!l.length&&l.event&&(r.detachEvent?r.detachEvent("on"+e,l.event):r["on"+e]=!1)}),e("dispatchEvent",function(e){var t=this,n=e.type,r=t.addEventListener.listeners=t.addEventListener.listeners||{},i=r[n]=r[n]||[];try{return t.fireEvent("on"+n,e)}catch(l){return void(i.event&&i.event(e))}})}();var Kt="DOMEVENT_STOPPED",Jt=["blur","error","focus","focusin","focusout","load","resize","scroll"];u.Handler=function(e){if(!e[Kt]){var t,n,r,i,l,o,u,a=this,s=e.type,c=e.target,f=[];switch(c&&3===c.nodeType&&(c=c.parentNode),i=a.$element,r=i.$listeners,l=e.eventPhase||(e.target!==e.currentTarget?3:2)){case 1:f=r[1][s];break;case 2:r[0]&&r[0][s]&&(f=f.concat(r[0][s])),r[1]&&r[1][s]&&(f=f.concat(r[1][s]));break;case 3:f=r[0][s]}for(n=f.length;n&&c;){for(t=0;n>t&&(o=f[t],o);t++)if(o.matcher(o.matcherParam,c)&&(u=o.handler.call(c,e,c)),!1===u||!1===e.returnValue)return e[Kt]=!0,void e.preventDefault();if(i===c)break;n=f.length,c=c.parentElement}}},u[c]={constructor:u,$element:null,$handle:null,dispose:function(){var e=this;return e.off().element(),e.$element=null,e.$handle=null,e},element:function(e){var t,n,r,i=this,l=i.$element;if(l){for(t=l.$listeners,n=g(t[1]),r=0;r<n.length;r++)l.removeEventListener(n[r],i.$handle,!0);for(n=g(t[0]),r=0;r<n.length;r++)l.removeEventListener(n[r],i.$handle,!1);l.$listeners=a}return e&&e.addEventListener?(i.$element=e,e.$listeners=e.$listeners||[{},{}],i):(i.$element=null,i)},on:function(e,t,u,s){var c,f,d,h,m,p,v,$,g=this;if(c=g.$element,!c)return g;if(!e)throw new TypeError("Invalid event type: "+e);if(v=e.split(jt).map(At),!v.length)return g;if("function"==typeof t&&(s=u,u=t,t=null),"function"!=typeof u)throw new TypeError("Handler must be a type of Function");for(h=0,m=v.length;m>h;h++)$=a===s?n(v[h][0]):!!s,f=c.$listeners[$?1:0],f[v[h][0]]||(f[v[h][0]]=[],c.addEventListener(v[h][0],g.$handle,$)),t?/^[a-z]+$/i.test(t)?(p=t,d=i):/^#[a-z0-9\-_]+$/i.test(t)?(p=t.slice(1),d=l):(p=t,d=o):(p=c,d=r),f[v[h][0]].push({selector:t,handler:u,matcher:d,matcherParam:p,namespace:v[h][1].join(".")});return g},off:function(e,t,n,r){var i,l,o,u,s,c,f,d,h,m,p=this,v=p.$element,$=!1;if(!v)return p;if("function"==typeof t&&(r=n,n=t,t=null),$=a===r?[0,1]:r?[1]:[0],m=e?e.split(/\s+/g).map(At):[],m.length){for(c=0;c<$.length;c++)for(o=v.$listeners[$[c]],s=0;s<m.length;s++)if(d=m[s][1],f=m[s][0],h=It(d),f.length){if(u=o[f],!u||!u.length)continue;for(i=u.length-1;i>=0;i--)l=u[i],t&&t!==l.selector||n&&n!==l.handler||h&&!h.test(l.namespace)||u.splice(i,1);u.length||(delete o[f],v.removeEventListener(f,p.$handle,!!$[c]))}else for(f in o)if(u=o[f],u&&u.length){for(i=u.length-1;i>=0;i--)l=u[i],t&&t!==l.selector||n&&n!==l.handler||h&&!h.test(l.namespace)||u.splice(i,1);u.length||(delete o[f],v.removeEventListener(f,p.$handle,!!$[c]))}}else for(c=0;c<$.length;c++){o=v.$listeners[$[c]];for(f in o)if(u=o[f],u&&u.length){for(i=u.length-1;i>=0;i--)l=u[i],t&&t!==l.selector||n&&n!==l.handler||u.splice(i,1);u.length||(delete o[f],v.removeEventListener(f,p.$handle,!!$[c]))}}return p}};var Yt=2,Zt=function(e,t,n){var r=this;return r instanceof Zt?(r.type=e,r.target=t,r.currentTarget=t,r.timeStamp=Bt(),r.eventPhase=Yt,void(r.namespace=n||null)):new Zt(e,t,n)};Zt[c]={constructor:Zt,type:null,target:null,currentTarget:null,timeStamp:null,eventPhase:Yt,bubbles:!1,cancelable:!1,namespace:null,stopPropagation:function(){this.bubbles=!1},preventDefault:function(){}};var Gt={$PB:null,namespace:null,initPubSub:function(){var e=this;return e.$PB={},e},disposePubSub:function(){var e=this;return e.$PB=null,e},trigger:function(e,t){var n,r,i,l,o,u,a=this,s=a.$PB;if(o=At(e),e=o[0],u="evt_"+e,s[Z](u)&&(n=s[u])&&(l=n.length)){for(r=n.slice(0),o=o[1].join("."),e=new Zt(e,a,o),i=0;l>i&&(r[i][3]=1,!1!==r[i][0](e,t));i++);if(s[Z](u)&&(n=s[u])&&(l=n.length))if(n.oneOffs>0)for(i=l-1;i>=0;i--)r=n[i],r[2]&&r[3]&&(n.splice(i,1),n.oneOffs=n.oneOffs>0?n.oneOffs-1:0);else n.oneOffs=0}return a},on:function(e,t,n){var r,i,l,o,u,a=this,s=a.$PB;if(e&&e.length&&Q(t,P)){if(n=!!n,i=e.split(jt).map(At),!(u=i.length))return a;for(o=0;u>o;o++)e=i[o][0],r=i[o][1].join("."),l="evt_"+e,s[Z](l)||(s[l]=[],s[l].oneOffs=0),s[l].push([t,r,n,0]),n&&s[l].oneOffs++}return a},onTo:function(e,t,n,r){var i=this;return Q(n,P)&&(n=s(n,i)),e.on(t,n,r),i},off:function(e,t){var n,r,i,l,o,u,a,s,c,f,d,h=this,m=h.$PB;if(e&&e.length){for(a=Q(t,P),s=e.split(jt).map(At),c=0,f=s.length;f>c;c++)if(e=s[c][0],u=It(s[c][1]),e.length){if(d="evt_"+e,m[Z](d)&&(n=m[d])&&(l=n.length))for(i=l-1;i>=0;i--)o=n[i],a&&t!==o[0]||u&&!u.test(o[1])||(o[2]&&(n.oneOffs=n.oneOffs>0?n.oneOffs-1:0),n.splice(i,1))}else if(a||u)for(r in m)if(m[Z](r)){if(n=m[r],!n||!(l=n.length))continue;for(i=l-1;i>=0;i--)o=n[i],a&&t!==o[0]||u&&!u.test(o[1])||(o[2]&&(n.oneOffs=n.oneOffs>0?n.oneOffs-1:0),n.splice(i,1))}}else for(r in m)m[Z](r)&&delete m[r];return h},offFrom:function(e,t,n){var r=this;return e.off(t,n),r}};Gt.publish=Gt.trigger;var en=function(e,t){var n=this,r=arguments.length;n.$store={},n.$size=C,n.$interval=C,r>0&&e>0&&(n.$size=e),r>1&&t>0&&(n.$interval=t)};en[c]={constructor:en,$store:null,$size:null,$interval:null,dispose:function(){var e=this;return e.$store=null,e.$size=null,e.$interval=null,e},reset:function(){return this.$store={},this},size:function(e){return arguments.length?(e>0&&(this.$size=e),this):this.$size},interval:function(e){return arguments.length?(e>0&&(this.$interval=e),this):this.$interval},has:function(e){var t=this,n=e?t.$store["_"+e]:null;return!!(n&&Bt()-n.time<=t.$interval)},get:function(e){if(e){var t,n=this,r=n.$store,i="_"+e;if(r[Z](i))return t=r[i],Bt()-t.time>n.$interval?(delete r[i],a):t.data}return a},set:function(e,t){var n,r,i,l,o=this;if(e){for(l="_"+e,n=o.$store,r=o.$size,i=g(n);i.length>=r;)delete n[i.shift()];n[l]={key:e,data:t,time:Bt()}}return o},del:function(e){var t=e?"_"+e:null;return t&&this.$store[Z](t)&&delete this.$store[t],this},toString:function(){return"[ModelView.Cache]"}};var tn=function(e){return V(this,tn)?void(this.f=e||null):new tn(e)},nn=function(e){return V(this,nn)?void(this.f=e||null):new nn(e)},rn=function(e){var t,n;for(t in e)e[Z](t)&&(n=e[t],V(n,nn)?(e[t]=n.f,e[t].fEach=1):e[t]=n);return e},ln=function In(e){return e.NOT=function(){return In(function(t,n){return!e.call(this,t,n)})},e.AND=function(t){return In(function(n,r){var i=this;return e.call(i,n,r)&&t.call(i,n,r)})},e.OR=function(t){return In(function(n,r){var i=this;return e.call(i,n,r)||t.call(i,n,r)})},e.XOR=function(t){return In(function(n,r){var i=this,l=e.call(i,n,r),o=t.call(i,n,r);return l&&!o||o&&!l})},e.EQ=function(t){return In(function(n,r){var i=this,l=e.call(i,n,r),o=t.call(i,n,r);return l==o})},e.NEQ=function(t){return In(function(n,r){var i=this,l=e.call(i,n,r),o=t.call(i,n,r);return l!=o})},e},on={TypeCaster:function(e){return e},Cast:{COMPOSITE:function(){var e=arguments;return Q(e[0],A)&&(e=e[0]),function(t,n){for(var r=e.length;r--;)t=e[r].call(this,t,n);return t}},EACH:nn,FIELDS:function(e){return e=rn(Y({},e||{})),function(t){var n,r,i,l,o,u=this;for(n in e)if(e[Z](n))if(r=e[n],i=t[n],r.fEach&&Q(i,A)){for(l=i.length,o=0;l>o;o++)i[o]=r.call(u,i[o]);t[n]=i}else t[n]=r.call(u,i);return t}},DEFAULT:function(e){return function(t){var n=X(t);return(F&n||D&n&&!zt(t).length)&&(t=e),t}},BOOL:function(e){return!!e},INT:function(e){return parseInt(e,10)},FLOAT:function(e){return parseFloat(e,10)},MIN:function(e){return function(t){return e>t?e:t}},MAX:function(e){return function(t){return t>e?e:t}},CLAMP:function(e,t){if(e>t){var n=t;t=e,e=n}return function(n){return e>n?e:n>t?t:n}},TRIM:function(e){return zt(_(e))},LCASE:function(e){return _(e).toLowerCase()},UCASE:function(e){return _(e).toUpperCase()},STR:function(e){return""+e}},add:function(e,t){return Q(e,D)&&Q(t,P)&&(on.Cast[e]=t),on},del:function(e){return Q(e,D)&&on.Cast[Z](e)&&delete on.Cast[e],on},toString:function(){return"[ModelView.Type]"}},un={Validator:ln,Validate:{EACH:nn,FIELDS:function(e){return e=rn(Y({},e||{})),ln(function(t){var n,r,i,l,o,u=this;for(n in e)if(e[Z](n))if(r=e[n],i=t[n],r.fEach&&Q(i,A)){for(l=i.length,o=0;l>o;o++)if(!r.call(u,i[o]))return!1}else if(!r.call(u,i))return!1;return!0})},NUMERIC:ln(function(e){return K(e)}),NOT_EMPTY:ln(function(e){return!!(e&&0<zt(_(e)).length)}),MAXLEN:function(e){return ln(S("v","return v.length <= "+e+";"))},MINLEN:function(e){return ln(S("v","return v.length >= "+e+";"))},MATCH:function(e){return ln(function(t){return e.test(t)})},NOT_MATCH:function(e){return ln(function(t){return!e.test(t)})},EQUAL:function(e,t){return ln(V(e,tn)?S("v","return this.$data."+e.f+" "+(!1!==t?"===":"==")+" v;"):!1!==t?function(t){return e===t}:function(t){return e==t})},NOT_EQUAL:function(e,t){return ln(V(e,tn)?S("v","return this.$data."+e.f+" "+(!1!==t?"!==":"!=")+" v;"):!1!==t?function(t){return e!==t}:function(t){return e!=t})},GREATER_THAN:function(e,t){return V(e,tn)?e="this.$data."+e.f:Q(e,D)&&(e='"'+e+'"'),ln(S("v","return "+e+" "+(!1!==t?"<":"<=")+" v;"))},LESS_THAN:function(e,t){return V(e,tn)?e="this.$data."+e.f:Q(e,D)&&(e='"'+e+'"'),ln(S("v","return "+e+" "+(!1!==t?">":">=")+" v;"))},BETWEEN:function(e,t,n){Q(e,A)&&(n=t,t=e[1],e=e[0]);var r,i=V(e,tn),l=V(t,tn);return!i&&!l&&e>t&&(r=t,t=e,e=r),e=i?"this.$data."+e.f:Q(e,D)?'"'+e+'"':e,t=l?"this.$data."+t.f:Q(t,D)?'"'+t+'"':t,ln(!1!==n?S("v","return ( "+e+" < v ) && ( "+t+" > v );"):S("v","return ( "+e+" <= v ) && ( "+t+" >= v );"))},NOT_BETWEEN:function(e,t,n){Q(e,A)&&(n=t,t=e[1],e=e[0]);var r,i=V(e,tn),l=V(t,tn);return!i&&!l&&e>t&&(r=t,t=e,e=r),e=i?"this.$data."+e.f:Q(e,D)?'"'+e+'"':e,t=l?"this.$data."+t.f:Q(t,D)?'"'+t+'"':t,ln(!1!==n?S("v","return ( "+e+" > v ) || ( "+t+" < v );"):S("v","return ( "+e+" >= v ) || ( "+t+" <= v );"))},IN:function(){var e=E(arguments);return Q(e[0],A)&&(e=e[0]),ln(function(t){return-1<e.indexOf(t)})},NOT_IN:function(){var e=E(arguments);return Q(e[0],A)&&(e=e[0]),ln(function(t){return 0>e.indexOf(t)})},MIN_ITEMS:function(e,t){return e=parseInt(e,10),ln(P===X(t)?function(n){return n.length>=e&&n.filter(t).length>=e}:function(t){return t.length>=e})},MAX_ITEMS:function(e,t){return e=parseInt(e,10),ln(P===X(t)?function(n){return n.filter(t).length<=e}:function(t){return t.length<=e})}},add:function(e,t){return Q(e,D)&&Q(t,P)&&(un.Validate[e]=Q(t.XOR,P)?t:ln(t)),un},del:function(e){return Q(e,D)&&un.Validate[Z](e)&&delete un.Validate[e],un},toString:function(){return"[ModelView.Validation]"}},an=function(e,t){if(!e)return null;var n,r,i=[],l=e.length;for(n=0;l>n;n++)r=e[n],r&&(r[Z](t)&&i.push(r[t].n),r[Z](qt)&&i.push(r[qt].n));return i.length?i:null},sn=function(e,t){if(!e)return null;var n,r,i=e.length;if(t){for(n=0;i>n;n++)if(r=e[n]){if(r[Z](t)&&r[t].v)return r[t].v;if(r[Z](qt)&&r[qt].v)return r[qt].v}}else for(n=0;i>n;n++)if(r=e[n],r&&r.v)return r.v;return null},cn=function(e,t,n,r){for(var i,l=n,o=0,u=t.length;u>o;)i=t[o++],l[Z](i)||(l[i]=new Ut),l=l[i],u>o?l=l.n:r?(l.n[Z](qt)||(l.n[qt]=new Ut),l.n[qt].v=e):l.v=e;return n},fn=function(e,t,n,r){for(var i,l,o=t,u=n?[n]:null,a=0,s=e.length;s>a;){if(i=e[a++],l=X(o),!(s>a))return u&&sn(u,i)?!0:l&U&&o[Z](i)?!0:I===l&&"length"==i?!0:!1;if(l&U&&o[Z](i)){if(o=o[i],o instanceof r)return[r,o,e.slice(a)];u&&(u=an(u,i))}else if(!u||!(u=an(u,i)))return!1}return!1},dn=function(e,t,n,r){for(var i,l,o=t,u=n?[n]:null,a=0,s=e.length;s>a;){if(i=e[a++],l=X(o),!(s>a))return u&&(u=sn(u,i))?[!1,u]:l&U&&o[Z](i)?[!0,o[i]]:I===l&&"length"==i?[!0,g(o).length]:!1;if(l&U&&o[Z](i)){if(o=o[i],o instanceof r)return[r,o,e.slice(a)];u&&(u=an(u,i))}else if(!u||!(u=an(u,i)))return!1}return!1},hn=function(e,t,n,r){for(var i,l,o=t,u=n,a=0,s=e.length;s>a;){if(i=e[a++],l=X(o),!(s>a))return o[i]instanceof r?[r,o[i],e.slice(a)]:u&&l&U&&o[Z](i)?[!0,o,i,u]:!1;if(!(l&U&&o[Z](i)))return!1;if(o=o[i],o instanceof r)return[r,o,e.slice(a)];if(!u||!(u=an(u,i)))return!1}return!1},mn=function(e,t,n,r,i,l,o){var u,a,s=t,c=null,f=null,d=null,h=0,m=e.length;for(o=!1!==o,o&&(c=[n],f=[r],d=[i]);m>h;)if(u=e[h++],a=X(s),m>h)if(a&U&&s[Z](u)){if(s=s[u],s instanceof l)return[l,s,e.slice(h),0,null,null,null];o&&(c=an(c,u),f=an(f,u),d=an(d,u))}else{if(!(o&&d&&(d=an(d,u))))return[!1,s,u,e,null,null,null];c=an(c,u),f=an(f,u)}else if(a&U)return s[u]instanceof l?[l,s[u],e.slice(h),0,null,null,null]:s[Z](u)?[!0,s,u,e.slice(h),c,f,d]:[!1,s,u,e.slice(h),c,f,d];return[!1,s,u,e.slice(h),null,null,null]},pn=function(e){return e.replace(/\[([^\]]*)\]/g,".$1").replace(/^\.+/,"").replace(/\.+$/,"")},vn=function(e){return"["+e.split(".").join("][")+"]"},$n=function(e){var t=new h("^"+e+"([\\.|\\[])");return function(e,n){var r=e.replace(t,"$1");return n?pn(r):r}},gn=function Pn(e,t,n,r){var i,l,o=!1;if(l=X(n),P&l)o=V(n,nn),o&&(n=n.f),cn(n,-1<t.indexOf(".")?t.split("."):[t],r,o);else if(U&l)for(i in n)n[Z](i)&&Pn(e,t+"."+i,n[i],r)},yn=function Hn(e,t,n,r){var i,l;if(l=X(n),P&l)cn(n,-1<t.indexOf(".")?t.split("."):[t],r);else if(U&l)for(i in n)n[Z](i)&&Hn(e,t+"."+i,n[i],r)},bn=function zn(e,t,n,r){var i,l;for(arguments.length<3&&(n=e.$data);n instanceof t;)n=n.data();if(l=r||X(n),n=I&l?Y({},n):A&l?n.slice(0):n,U&l)for(i in n)n[Z](i)&&(n[i]instanceof t?n[i]=zn(n[i],t,Y({},n[i].data())):U&(l=X(n[i]))&&(n[i]=zn(e,t,n[i],l)));return n},_n=function Fn(e,t,n,r,i,l){var o,u,a,s,c,f,d,h,m,p={isValid:!0,errors:[]};if(i=i||e.$data,l=l||[e.$validators],l&&l.length)if(r){if(m=function(e){return d?d+"."+e:e},c=hn(h=r.split("."),o=i,l,t))if(o=c[1],u=c[2],t===c[0]){if(d=h.slice(0,h.length-u.length).join("."),f=Fn(o,t,n,u.length?u.join("."):null),f.isValid||(p.errors=p.errors.concat(f.errors.map(m)),p.isValid=!1),!p.isValid&&n)return p}else{if(d=h.slice(0,-1).join("."),a=o[u],s=sn(c[3],u),s&&!s.call(e,a,r)&&(p.errors.push(r),p.isValid=!1,n))return p;if(U&X(a)&&(l=an(c[3],u))&&l.length){d+=d?"."+u:u;for(u in a)if(a[Z](u)&&(f=Fn(e,t,n,u,a,l),f.isValid||(p.errors=p.errors.concat(f.errors.map(m)),p.isValid=!1),n&&!p.isValid))return p}}}else if(U&X(i))for(u in i)if(i[Z](u)&&(f=Fn(e,t,n,u,i,l),f.isValid||(p.errors=p.errors.concat(f.errors),p.isValid=!1),n&&!p.isValid))return p;return p},kn=function(e,t){var n,r,i,l,o,u,a,s,c,f,d,h,m,p,v,$=e.target,y=$.$syncTo,b=t.key;if(b){for(r=b+".",i=g(y),l=i.length,m=$.atomic,p=$.$atom,$.atomic=!0,$.$atom=b,s=0;l>s;s++)if(c=i[s],c===b||Ft(c,r))for(f=y[c],n=$.get(c),d=0,h=f.length;h>d;d++)u=f[d][0],o=f[d][1],$.__syncing[u.$id]=$.__syncing[u.$id]||[],v=$.__syncing[u.$id],0>v.indexOf(o)&&(v.push(o),(a=f[d][2])?a.call(u,o,n,c,$):u.set(o,n,1),v.pop());$.$atom=p,$.atomic=m}},wn=function Bn(e,t,n,r,i,l,o){var u=this;return u instanceof Bn?(u.$id=Qt("Model"),u.namespace=u.id=e||u.$id,u.key=$n(u.id),u.$view=null,u.atomic=!1,u.$atom=null,u.$autovalidate=!0,u.$types={},u.$validators={},u.$getters={},u.$setters={},u.$idependencies={},u.$syncTo={},void u.data(t||{}).types(n).validators(r).getters(i).setters(l).dependencies(o).initPubSub()):new Bn(e,t,n,r,i,l,o)};wn.count=function(e){if(!arguments.length)return 0;var t=X(e);return I===t?g(e).length:A===t?e.length:F!==t?1:0},wn.sorter=pt,wn.Field=tn,wn[c]=Y($(p[c]),Gt,{constructor:wn,id:null,$id:null,$view:null,$data:null,$types:null,$idependencies:null,$validators:null,$getters:null,$setters:null,atomic:!1,$atom:null,$autovalidate:!0,$syncTo:null,$syncHandler:null,__syncing:null,dispose:function(){var e=this;return e.disposePubSub().$view=null,e.$data=null,e.$types=null,e.$idependencies=null,e.$validators=null,e.$getters=null,e.$setters=null,e.atomic=!1,e.$atom=null,e.key=null,e.$autovalidate=!1,e.$syncTo=null,e.$syncHandler=null,e.__syncing=null,e},view:function(e){var t=this;return arguments.length?(t.$view=e,t):t.$view},data:function(e){var t=this;return arguments.length?(t.$data=e,t):t.$data},dependencies:function(e){var t,n,r,i,l,o,u=this,a=u.$idependencies;if(Q(e,I))for(t in e)if(e[Z](t))for(n=e[t]?[].concat(e[t]):[],r=0;r<n.length;r++)for(l=n[r].split("."),i=l[0],a[Z](i)||(a[i]=[]),0>a[i].indexOf(t)&&a[i].push(t),o=1;o<l.length;o++)i+="."+l[o],a[Z](i)||(a[i]=[]),0>a[i].indexOf(t)&&a[i].push(t);return u},types:function(e){var t,n=this;if(Q(e,I))for(t in e)e[Z](t)&&gn(n,t,e[t],n.$types);return n},validators:function(e){var t,n=this;if(Q(e,I))for(t in e)e[Z](t)&&gn(n,t,e[t],n.$validators);return n},getters:function(e){var t,n=this;if(Q(e,I))for(t in e)e[Z](t)&&yn(n,t,e[t],n.$getters);return n},setters:function(e){var t,n=this;if(Q(e,I))for(t in e)e[Z](t)&&yn(n,t,e[t],n.$setters);return n},serialize:function(){return bn(this,wn)},validate:function(e,t){return _n(this,wn,!!e,t)},autovalidate:function(e){var t=this;return arguments.length?(t.$autovalidate=!!e,t):t.$autovalidate},toJSON:function(e){var t,n,r,i=this;n=arguments.length?i.get(e):i.data();try{t=Ht(bn(i,wn))}catch(r){throw r}return t},fromJSON:function(e,t,n){var r,i,l=this;if(e){try{r=Pt(e)}catch(i){throw i}t?l.set(t,r,!0===n):l.data(r)}return l},has:function(e,t){var n,r=this,i=r.$data,l=r.$getters;return 0>e.indexOf(".")&&(i[Z](e)||!t&&(n=l[e]||l[qt])&&n.v)?!0:(n=fn(e.split("."),i,t?null:l,wn))?!0===n?!0:n[1].has(n[2].join(".")):!1},get:function(e,t){var n,r=this,i=r.$data,l=r.$getters;return 0>e.indexOf(".")?!t&&(n=l[e]||l[qt])&&n.v?n.v.call(r,e):i[e]:(n=dn(e.split("."),i,t?null:l,wn))?wn===n[0]?n[1].get(n[2].join("."),t):!1===n[0]?n[1].call(r,e):n[1]:a},set:function(e,t,n,r){var i,l,o,u,a,s,c,f,d,h,m,p=this,v=!1,$=p.$autovalidate;if(p.atomic&&Ft(e,p.$atom))return p;if(l=p.$data,c=p.$types,f=p.$validators,d=p.$setters,h=p.$idependencies,0>e.indexOf("."))o=e,s=(i=d[o])?i.v:null,u=(i=c[o]||c[qt])?i.v:null,a=$&&(i=f[o]||f[qt])?i.v:null,v=!0;else if(i=mn(e.split("."),l,c,$?f:null,d,wn)){if(l=i[1],o=i[2],u=sn(i[4],o),a=sn(i[5],o),s=sn(i[6],o),wn===i[0])return o.length?(o=o.join("."),m=l.get(o),m!==t?l.set(o,t,n,r):n=!1):(m=l.data(),m!==t?l.data(t):n=!1),n&&(p.publish("change",{key:e,value:t,valuePrev:m,$callData:r}),h[Z](e)&&p.notify(h[e])),p;if(!s&&!1===i[0]&&i[3].length)return p;v=!0}if(v){if(u&&(t=u.call(p,t,e)),a&&!a.call(p,t,e))return n&&(r&&(r.error=!0),p.publish("error",{key:e,value:l[o],$callData:r})),p;if(s)return!1!==s.call(p,e,t,n)&&(n&&(p.publish("change",{key:e,value:t,$callData:r}),h[Z](e)&&p.notify(h[e])),p.$atom&&e===p.$atom&&(p.atomic=!0)),p;m=l[o],m!==t&&(l[o]=t,n&&(p.publish("change",{key:e,value:t,valuePrev:m,$callData:r}),h[Z](e)&&p.notify(h[e])),p.$atom&&e===p.$atom&&(p.atomic=!0))}return p},add:function(e,t,n,r){var i,l,o,u,s,c,f,d,h,m,p=this,v=!1,$=p.$autovalidate;if(p.atomic&&Ft(e,p.$atom))return p;if(l=p.$data,f=p.$types,d=p.$validators,h=p.$setters,m=p.$idependencies,0>e.indexOf("."))o=e,c=(i=h[o])&&i.n[qt]?i.n[qt].v:null,u=(i=f[o]||f[qt])&&i.n[qt]?i.n[qt].v:null,s=$&&(i=d[o]||d[qt])&&i.n[qt]?i.n[qt].v:null,v=!0;else if(i=mn(e.split("."),l,f,$?d:null,h,wn)){if(l=i[1],o=i[2],u=sn(an(i[4],o),qt),s=sn(an(i[5],o),qt),c=sn(an(i[6],o),qt),wn===i[0])return o.length?(o=o.join("."),l.add(o,t,n,r)):l.data(t),n&&(p.publish("append",{key:e,value:t,$callData:r}),m[Z](e)&&p.notify(m[e])),p;if(!c&&!1===i[0]&&i[3].length)return p;v=!0}if(v){if(u&&(t=u.call(p,t,e)),s&&!s.call(p,t,e))return n&&(r&&(r.error=!0),p.publish("error",{key:e,value:a,$callData:r})),p;if(c)return!1!==c.call(p,e,t,n)&&(n&&(p.publish("append",{key:e,value:t,$callData:r}),m[Z](e)&&p.notify(m[e])),p.$atom&&e===p.$atom&&(p.atomic=!0)),p;A===X(l[o])?l[o].push(t):l[o]=t,n&&(p.publish("append",{key:e,value:t,$callData:r}),m[Z](e)&&p.notify(m[e])),p.$atom&&e===p.$atom&&(p.atomic=!0)}return p},del:function(e,t,n,r){var i,l,o,u,s=this,c=!1;if(s.atomic&&Ft(e,s.$atom))return s;if(n=!!n,l=s.$data,0>e.indexOf("."))o=e,c=!0;else if(i=mn(e.split("."),l,null,null,null,wn,!1)){if(l=i[1],o=i[2],wn===i[0]&&o.length)return o=o.join("."),u=l.get(o),l.del(o,n,t,r),t&&s.publish("delete",{key:e,value:u,$callData:r}),s.$atom&&e===s.$atom&&(s.atomic=!0),s;if(i[3].length)return s;c=!0}return c&&(u=l[o],n?(l[o]=a,T=X(l),A==T&&J(o)?l.splice(+o,1):I==T&&delete l[o]):delete l[o],t&&s.publish("delete",{key:e,value:u,$callData:r}),s.$atom&&e===s.$atom&&(s.atomic=!0)),s},sync:function(e,t){var n,r,i,l,o,u,a=this;for(n in t)if(t[Z](n)){for(r=t[n],a.$syncTo[n]=a.$syncTo[n]||[],i=null,A===X(r)&&(i=r[1]||null,r=r[0]),l=a.$syncTo[n],u=1,o=l.length-1;o>=0;o--)if(e===l[o][0]&&r===l[o][1]){l[o][2]=i,u=0;break}u&&l.push([e,r,i])}return a.$syncHandler||(a.__syncing=a.__syncing||{},a.on("change",a.$syncHandler=kn)),a},unsync:function(e){var t,n,r,i=this,l=i.$syncTo;for(t in l)if(l[Z](t)){if(!(n=l[t])||!n.length)continue;for(r=n.length-1;r>=0;r--)e===n[r][0]&&(i.__syncing&&i.__syncing[e.$id]&&O(i.__syncing,e.$id),n.splice(r,1))}return i},notify:function(e,t,n){var r,i,l,o,u,a,s=this,c=s.$idependencies,f=[],d={};if(e){if(u=X(e),t=t||"change",l={key:""},n&&(n[Z]("value")&&(l.value=n.value),n[Z]("$callData")&&(l.$callData=n.$callData)),D===u)l.key=e,d["_"+e]=1,c[Z](e)&&(f=f.concat(c[e])),s.publish(t,l);else if(A===u)for(i=e.length,r=0;i>r;r++)l.key=o=e[r],d[Z]("_"+o)||(d["_"+o]=1,c[Z](o)&&(f=f.concat(c[o])),s.publish(t,l));for(;i=f.length;){for(a=[],l={key:""},r=0;i>r;r++)o=f[r],d[Z]("_"+o)||(d["_"+o]=1,c[Z](o)&&(a=a.concat(c[o])),l.key=o,s.publish("change",l));f=a}}return s},atom:function(e){var t=this;return a!==e&&(!1===e?(t.atomic=!1,t.$atom=null):(t.atomic=!1,t.$atom=e)),t},toString:function(){return"[ModelView.Model id: "+this.id+"]"}}),wn[c].append=wn[c].add,wn[c].rem=wn[c].del;var En="mv_namedkey",Tn="mv_uuid",Sn=0,Vn=function(e){return e[Tn]=e[Tn]||e.id||"_"+(++Sn).toString(16)},xn=function Un(e){var t=this;return t instanceof Un?(t.id=e||Qt("Tpl"),void t.initPubSub()):new Un(e)};xn.joinTextNodes=yt,xn.string2Dom=wt,xn.dom2String=Et,xn.multisplit=function(e,t,n){var r,i,l,o,u,a,s,c,f,d;n=!!n,a=[[1,e]];for(r in t)if(t[Z](r)){for(c=[],i=n?t[r]:r,l=[0,t[r]],o=0,f=a.length;f>o;o++)if(1===a[o][0]){if(s=a[o][1].split(i),d=s.length,c.push([1,s[0]]),d>1)for(u=0;d-1>u;u++)c.push(l),c.push([1,s[u+1]])}else c.push(a[o]);a=c}return a},xn.multisplit_re=function(e,t){for(var n,r=[],i=0;n=t.exec(e);)r.push([1,e.slice(i,t.lastIndex-n[0].length)]),r.push([0,n[1]?n[1]:n[0]]),i=t.lastIndex;return r.push([1,e.slice(i)]),r},xn.compile=function(e){var t,n,r,i=e.length,l='"use strict";\nreturn (';for(t=0;i>t;t++)n=e[t][0],r=e[t][1],l+=n?"'"+r.replace(SQUOTE,"\\'").replace(NEWLINE,"' + \"\\n\" + '")+"'":" + String(args['"+r+"']) + ";return l+=");",S("args",l)},xn.multisplit_dom=function(e,t,n,r){if(!t)return n;var i,l,o,u,a,s,c,f,d,h,m,p,v,$,y,b,_,k,w;if(n=n||{},e){if(i=[],l=[],c=e,c.attributes&&(u=c.attributes.length))for(o=0;u>o;o++)f=c.attributes[o],(a=f.nodeValue.match(t))&&l.push([f,a,c]);if(3===c.nodeType)(a=c.nodeValue.match(t))&&i.push([c,a,c[ct]]);else if(c.firstChild)for(_=[c=c.firstChild];_.length;){if(c.attributes&&(u=c.attributes.length))for(o=0;u>o;o++)f=c.attributes[o],(a=f.nodeValue.match(t))&&l.push([f,a,c]);if(c.firstChild)_.push(c=c.firstChild);else{for(3===c.nodeType&&(a=c.nodeValue.match(t))&&i.push([c,a,c[ct]]),c=_.pop();_.length&&!c.nextSibling;)c=_.pop();c.nextSibling&&_.push(c=c.nextSibling)}}for(m={},o=0,u=i.length;u>o;o++)if(s=i[o],b=s[0],a=s[1],c=s[2],h=Vn(c),n[h]=n[h]||{},m[h]=c,n[h].keys=n[h].keys||{},k=n[h].keys,y=b.nodeValue,y.length>a[0].length){do d=a[1],p=b.splitText(a.index),b=p.splitText(a[0].length),(k[d]=k[d]||[]).push(p),a=b.nodeValue.match(t);while(a)}else d=a[1],p=b,(k[d]=k[d]||[]).push(p);for(v={},o=0,u=l.length;u>o;o++)if(s=l[o],f=s[0],a=s[1],c=s[2],h=Vn(c),n[h]=n[h]||{},m[h]=c,n[h].keys=n[h].keys||{},k=n[h].keys,n[h].atts=n[h].atts||{},w=n[h].atts,y=f.nodeValue,$=y in v)for(a=0;a<v[y][0].length;a++)w[v[y][0][a]].push([f,v[y][1],y]);else if(b=St(y),v[y]=[[],[b]],y.length>a[0].length){do d=a[1],p=b.splitText(a.index),b=p.splitText(a[0].length),v[y][0].push(d),v[y][1].push(p),v[y][1].push(b),(k[d]=k[d]||[]).push(p),(w[d]=w[d]||[]).push([f,v[y][1],y]),a=b.nodeValue.match(t);while(a)}else p=b,v[y][0].push(d),(k[d]=k[d]||[]).push(p),(w[d]=w[d]||[]).push([f,v[y][1],y]);for(d=g(m),a=0;a<d.length;a++)c=m[h=d[a]],c[et](r,"|"+g(n[h].keys).join("|"))}return n},xn.render_str=function(e,t){var n,r,i,l=e.length,o="";for(n=0;l>n;n++)r=e[n][0],i=e[n][1],o+=r?i:String(t[i]);return o},xn.render_dom=function(){},xn.render_view=function(e,t,n,r,i,l,o,u){var a,s,c,f,d,h,m,p,v,$,y,b,_,k,w,E,T=i.length,S=e.$keynodes,V={};if(S)if(l){for(_=l+".",o=""+n.get(l),s=0;T>s;s++)if(a=i[s],a&&(E=a[Tn])&&S[Z](E)){if(k=S[E].keys){if(k[Z](l))for(d=k[l],f=0,h=d.length;h>f;f++)d[f].nodeValue=o;for(m=g(k),p=0,y=m.length;y>p;p++)if(v=m[p],l!==v&&Ft(v,_)&&(d=k[v]).length)for($="_"+v,V[Z]($)?b=V[$][0]:V[$]=[b=""+n.get(v)],f=0,h=d.length;h>f;f++)d[f].nodeValue=b}if(w=S[E].atts){if(w&&w[Z](l))for(d=w[l],f=0,h=d.length;h>f;f++)d[f][0].nodeValue=xn.joinTextNodes(d[f][1]);for(m=g(w),p=0,y=m.length;y>p;p++)if(v=m[p],l!==v&&Ft(v,_)&&(d=w[v]).length)for(f=0,h=d.length;h>f;f++)c=d[f],$="_"+c[2],V[Z]($)?b=V[$][0]:V[$]=[b=xn.joinTextNodes(c[1])],c[0].nodeValue=b}}}else if(u)for(s=0;T>s;s++)if(a=i[s],a&&(E=a[Tn])&&S[E]){if(k=S[E].keys)for(m=g(k),p=0,y=m.length;y>p;p++)if(v=m[p],(d=k[v])&&(h=d.length))for($="_"+v,V[Z]($)?b=V[$][0]:V[$]=[b=""+n.get(v)],f=0;h>f;f++)d[f].nodeValue=b;
if(w=S[E].atts)for(m=g(w),p=0,y=m.length;y>p;p++)if(v=m[p],(d=w[v])&&(h=d.length))for(f=0;h>f;f++)c=d[f],$="_"+c[2],V[Z]($)?b=V[$][0]:V[$]=[b=xn.joinTextNodes(c[1])],c[0].nodeValue=b}},xn.free=function(e,t,n){var r;return t&&(r=e[Tn])&&t[Z](r)&&O(t,r),e[G](n)&&e.removeAttribute(n),t},xn[c]=Y($(p[c]),Gt,{constructor:xn,id:null,$tpl:null,$dom:null,$key:null,$atkeys:null,$keynodes:null,$renderer:null,dispose:function(){var e=this;return e.disposePubSub(),e.$renderer=null,e.$tpl=null,e.$dom=null,e.$key=null,e.$atkeys=null,e.$keynodes=null,e},dom:function(e,t,n){var r=this;return r.$tpl=null,r.$dom=e,r.$key=t,r.$atkeys=n,r.$keynodes=xn.multisplit_dom(r.$dom,r.$key,null,r.$atkeys),r},str:function(e,t,n){var r=this;return r.$dom=null,r.$tpl=t instanceof RegExp?xn.multisplit_re(e,t):xn.multisplit(e,t),!0===n&&(r.$renderer=xn.compile(r.$tpl)),r},bind:function(e){var t=this;return e&&(t.$keynodes=xn.multisplit_dom(e,t.$key,t.$keynodes,t.$atkeys)),t},free:function(e){return e&&(tpl.$keynodes=xn.free(e,tpl.$keynodes,tpl.$atkeys)),tpl},renderView:function(e,t,n,r,i,l,o){var u=this;return u.$dom&&xn.render_view(u,e,t,n,r,i,l,o),u},render:function(e){var t=this;return t.$dom?(e=e||{},xn.render_dom(t,e),t):t.$tpl?(e=e||[],t.$renderer?t.$renderer(e):xn.render_str(t.$tpl,e)):void 0},toString:function(){return"[ModelView.Tpl id: "+this.id+"]"}});var Cn=function(e,t){return new h(N(e).replace("__MODEL__",N(t||"")).replace("__KEY__","(\\S+?)"),"")},Nn=function(e,t,n){return[e?"["+e+"]":null,t?t[1]?"["+t[0]+'*="|'+t[1]+'"]':"["+t[0]+"]":null,n?n[1]?'input[name="'+n[0]+'"],textarea[name="'+n[0]+'"],select[name="'+n[0]+'"]':'input[name^="'+n[0]+'"],textarea[name^="'+n[0]+'"],select[name^="'+n[0]+'"]':null]},On=function(e,t){return t&&t[e]?(Q(t[e],D)&&(t[e]={action:t[e]}),t[e]):void 0},Mn=function(e,t,n,r){var i,l,o,u,a,s,c=e.$model,f="sync"==n.type,d=f?"change":n.type,h=t.length,m=r&&r.key?r.key:null,p=!m,v=m?m+".":null,$=c.atomic,g=c.$atom,y=$?g+".":null;for(i=0;h>i;i++)l=t[i],l&&(o=On(d,e.attr(l,"bind")),o&&o[Z]("action")&&(u="do_"+o.action,Q(e[u],P)&&(a=l[it],s=o.key,s||(!l[En]&&a&&(l[En]=c.key(a,1)),s=l[En]),$&&s&&(g===s||Ft(s,y))||m&&!s||(p||s===m||Ft(s,v))&&e[u](n,l,o))))},Ln=function(e,t,n){var r,i,l,o,u,a,s=e.$model,c={},f=t.length;for(r=0;f>r;r++)if(i=t[r],i&&(l=i[it],o=0,!i[En]&&l&&(i[En]=s.key(l,1)),o=i[En])){if(u="_"+o,c[Z](u))a=c[u][0];else{if(!s.has(o))continue;c[u]=[a=s.get(o)]}e.do_bind(n,i,{name:l,key:o,value:a})}},Rn={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},Dn={27:"escape",9:"tab",32:"space",13:"enter",8:"backspace",145:"scrolllock",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"delete",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},jn=function(e,t){return function(n){return e[t](n,{el:this})}},An=function qn(e,t,n,r,i){var l=this;return l instanceof qn?(l.namespace=l.id=e||Qt("View"),(n=n||{})[Z]("bind")||(n.bind="data-bind"),n[Z]("keys")||(n.keys="data-mvkeys"+ ++Sn),l.$atts=n,r=r||qn._CACHE_SIZE,i=i||qn._REFRESH_INTERVAL,l.$memoize=new en(r,C),l.$selectors=new en(r,i),l.$atbind=l.attribute("bind"),l.$atkeys=l.attribute("keys"),l.$shortcuts={},l.$num_shortcuts=0,void l.model(t||new wn).initPubSub()):new qn(e,t,n,r,i)};return An._CACHE_SIZE=600,An._REFRESH_INTERVAL=C,An.node=gt,An.index=vt,An.indexClosest=$t,An.getDomRef=kt,An[c]=Y($(p[c]),Gt,{constructor:An,id:null,$dom:null,$dom_tpl:null,$model:null,$livebind:null,$autobind:!1,$bindbubble:!1,$template:null,$atts:null,$memoize:null,$selectors:null,$atbind:null,$atkeys:null,$shortcuts:null,$num_shortcuts:null,dispose:function(){var e=this;return e.unbind().disposePubSub(),e.$model&&e.$model.dispose(),e.$model=null,e.$dom=null,e.$dom_tpl&&e.$dom_tpl.dispose(),e.$dom_tpl=null,e.$template=null,e.$atts=null,e.$memoize.dispose(),e.$memoize=null,e.$selectors.dispose(),e.$selectors=null,e.$livebind=null,e.$atbind=null,e.$atkeys=null,e.$shortcuts=null,e.$num_shortcuts=null,e},model:function(e){var t=this;return arguments.length?(t.$model&&t.$model.dispose(),t.$model=e.view(t),t):t.$model},attribute:function(e,t){var n=this;return arguments.length>1?(n.$atts[e]=t,n.$atbind=n.$atts.bind,n.$atkeys=n.$atts.keys,n):e?n.$atts[e]||a:a},template:function(e){var t=this;return arguments.length?(Q(e,P)&&(t.$template=e),t):t.$template},events:function(e){var t,n=this;if(Q(e,I))for(t in e)e[Z](t)&&Q(e[t],P)&&(n["on_"+t.split(":").join("_")]=e[t]);return n},shortcuts:function(e){var t,n,r,i,l,o=this,u=o.$shortcuts;if(Q(e,I))for(t in e)if(e[Z](t)){for(i=[],r=t.toLowerCase().split("+").map(zt),l=r.length-1;l>=0;l--)n=r[l],("alt"===n||"ctrl"===n||"shift"===n||"meta"===n)&&(i.push(n),r.splice(l,1));n=i.sort().concat(r).join("+"),!1===e[t]?u[Z](n)&&(O(u,n),o.$num_shortcuts--):(u[Z](n)||o.$num_shortcuts++,u[n]=e[t])}return o},actions:function(e){var t,n=this;if(Q(e,I))for(t in e)e[Z](t)&&Q(e[t],P)&&(n["do_"+t]=e[t]);return n},autovalidate:function(e){return arguments.length?(this.$model.autovalidate(e),this):this.$model.autovalidate()},livebind:function(e){var t=this;return arguments.length?(t.$livebind=e?Cn(e,t.$model?t.$model.id:""):null,t):t.$livebind},autobind:function(e){var t=this;return arguments.length?(t.$autobind=!!e,t):t.$autobind},bindbubble:function(e){var t=this;return arguments.length?(t.$bindbubble=!!e,t):t.$bindbubble},get:function(e,t,n,r){var i,l=this,o=l.$selectors;return t=t||l.$dom,(r||!(i=o.get(e)))&&(i=_t(e,t),n&&t[Tt](e)&&i.push(t),r||o.set(e,i)),i},attr:function(e,t){var n,r,i=this,l=i.$atts[t],o=i.$memoize;return(l=e[G](l))?(n=o.get(l),a===n&&(n=Pt(l),n.set&&(n.click=n.set,n.click.action="set",O(n,"set")),n.each&&(n.change={action:"each",key:n.each},O(n,"each")),n.show&&(n.change={action:"show",key:n.show},O(n,"show")),n.hide&&(n.change={action:"hide",key:n.hide},O(n,"hide")),n.html?(n.change={action:"html",key:n.html},O(n,"html"),O(n,"text")):n.text&&(n.change={action:"html",key:n.text,text:1},O(n,"text")),n.css&&(n.change={action:"css",css:n.css},O(n,"css")),n.value&&(n.change&&"prop"==n.change.action?n.change.prop.value=n.value:n.change={action:"prop",prop:{value:n.value}},O(n,"value")),n.checked&&(n.change&&"prop"==n.change.action?n.change.prop.checked=n.checked:n.change={action:"prop",prop:{checked:n.checked}},O(n,"checked")),n.disabled&&(n.change&&"prop"==n.change.action?n.change.prop.disabled=n.disabled:n.change={action:"prop",prop:{disabled:n.disabled}},O(n,"disabled")),n.options&&(n.change&&"prop"==n.change.action?n.change.prop.options=n.options:n.change={action:"prop",prop:{options:n.options}},O(n,"options")),(r=n.change)&&(!r.domRef&&n.domRef&&(r.domRef=n.domRef),!r.key&&n.key&&(r.key=n.key)),o.set(l,n)),n):a},add:function(e,t){var n=this;return e&&(n.$dom_tpl&&n.$dom_tpl.bind(e),!1!==t&&n.sync(null,e)),n},remove:function(e,t){var n=this;return e&&(n.$dom_tpl&&n.$dom_tpl.free(e),!1!==t&&n.$selectors.reset()),n},bind:function(e,n){var r,i,l,o=this,a=o.$model,s=Nn(o.$atbind,[o.$atkeys],[a.id+"["]),c=s[0],f=s[2],d=o.$autobind,h=!!o.$livebind;e=e||["change","click"],o.$dom=n||document.body,l=function(e){return t(e,o.namespace)},h&&(o.$dom_tpl=xn().dom(o.$dom,o.$livebind,o.$atkeys)),o.on_view_change&&e.length&&u(o.$dom).on(e.map(l).join(" "),d?[f,c].join(","):c,function(e){var t=this,n=!1,r=!1,i=o.$bindbubble?o.attr(t,"bind"):null;return(e.target===t||i&&i.bubble)&&(r=o.$bindbubble?!!i:t[Tt](c),n=d&&"change"==e.type&&t[Tt](f),(r||n)&&o.on_view_change(e,{el:t,isBind:r,isAutoBind:n})),!0});for(r in o)Q(o[r],P)&&(Ft(r,"on_document_")?(i=r.slice(12),i.length&&u(document.body).on(l(i),jn(o,r))):Ft(r,"on_model_")?(i=r.slice(9),i.length&&o.onTo(a,i,o[r])):Ft(r,"on_view_")&&"on_view_change"!==r?(i=r.slice(8),i.length&&u(o.$dom).on(l(i),d?[f,c].join(","):c,jn(o,r))):Ft(r,"on_dom_")&&(i=r.slice(7),i.length&&u(o.$dom).on(l(i),jn(o,r))));return o},unbind:function(e,n){{var r,i,l=this,o=l.$model,a=Nn(l.$atbind,[l.$atkeys],[o.id+"["]),s=t("",l.namespace),c=l.$autobind;!!l.$livebind}return e=e||null,i=n||l.$dom,r=function(e){return t(e,l.namespace)},l.on_view_change&&u(i).off(e&&e.length?e.map(r).join(" "):s,c?[a[2],a[0]].join(","):a[0]),l.offFrom(o),u(i).off(s),u(document.body).off(s),l.$dom_tpl&&(l.$dom_tpl.dispose(),l.$dom_tpl=null),l},rebind:function(e,t){var n=this;return n.$memoize.reset(),n.$selectors.reset(),n.unbind().bind(e,t)},sync:function(e,t){var n,r,i,l,o=this,u=o.$autobind,a=!!o.$livebind,s=Nn(o.$atbind,a?[o.$atkeys]:0,u?[o.$model.id+"["]:0),c=Zt("sync",o);return o.$selectors.reset(),t?(c.currentTarget=t,n=o.get(s[0],t,0,1),u&&(r=o.get(s[2],t,0,1)),a&&(i=o.get(s[1],t,1,1))):(e=e||o.$dom,l=!(e===o.$dom),n=o.get(s[0],e,0,l),u&&(r=o.get(s[2],e,0,l)),a&&(i=o.get(s[1],e,1,l))),n.length&&Mn(o,n,c),u&&r.length&&Ln(o,r,c),a&&i.length&&o.$dom_tpl.renderView(o,o.$model,c,i,null,null,!0),o},reset:function(){var e=this;return e.$memoize.reset(),e.$selectors.reset(),e},on_view_change:function(e,t){var n,r,i,l,o=this,u=o.$model,a=t.el,s={};t.isAutoBind&&(n=a[it])&&(a[En]||(a[En]=u.key(n,1)),r=a[En],r&&u.has(r)&&("checkbox"===a[ot].toLowerCase()?(l=o.get('input[type="checkbox"][name="'+n+'"]'),l.length>1?(i=[],l.forEach(function(e){i.push(e[tt]?e[ut]:"")})):i=a[tt]?a[ut]:""):i=Lt(a),s.$trigger=a,u.set(r,i,1,s))),!s.error&&t.isBind&&Mn(o,[a],e),o.publish("change",t)},on_document_keydown:function(e,t){var n,r,i,l,o,u,a=this,s=a.$shortcuts,c=t.el;if(a.$num_shortcuts&&"TEXTAREA"!==c.tagName&&"INPUT"!==c.tagName)return l=e.keyCode||e.which,u=[],e.altKey&&u.push("alt"),e.ctrlKey&&u.push("ctrl"),e.metaKey&&u.push("meta"),e.shiftKey&&u.push("shift"),Dn[Z](l)?i=Dn[l]:(o=188===l?",":190===l?".":_.fromCharCode(l).toLowerCase(),e.shiftKey&&Rn[Z](o)&&(o=Rn[o]),i=o),i=u.concat(i).join("+"),i&&s[Z](i)&&s[i]&&(n=s[i],r=!0,n.substr?Q(a["do_"+n],P)&&(a["do_"+n](e,c,{}),r=!1):r=n.call(a,e,c,{}),!1===r)?(e.stopPropagation(),e.preventDefault(),!1):void 0},on_model_change:function(e,t){var n,r,i,l,o=this,u=o.$model,a=o.$autobind,s=!!o.$livebind,c=Nn(o.$atbind,s?[o.$atkeys,t.key]:0,a?[u.id+vn(t.key)]:0);n=o.get(c[0]),a&&(r=o.get(c[2])),s&&(i=o.get(c[1],0,1)),t.$callData&&t.$callData.$trigger&&(l=function(e){return e!==t.$callData.$trigger},n=n.filter(l),a&&(r=r.filter(l)),t.$callData=null),n.length&&Mn(o,n,e,t),a&&r.length&&Ln(o,r,e,t),s&&i.length&&o.$dom_tpl.renderView(o,o.$model,e,i,t.key,t.value,"sync"==e.type)},on_model_error:function(e,t){var n,r,i,l=this,o=l.$model,u=l.$autobind,a=!!l.$livebind,s=Nn(l.$atbind,a?[l.$atkeys,t.key]:0,u?[o.id+vn(t.key)]:0);(n=l.get(s[0])).length&&Mn(l,n,e,t),u&&(r=l.get(s[2])).length&&Ln(l,r,e,t),a&&(i=l.get(s[1],0,1)).length&&l.$dom_tpl.renderView(l,l.$model,e,i,t.key,t.value,"sync"==e.type)},do_nop:null,do_each:function(){},do_prop:function(e,t,n){if(Q(n.prop,I)){var r,i,l,o,u=this,a=u.$model,s=n.prop;if(n.domRef&&(t=An.getDomRef(t,n.domRef)[0]),t)for(r in s)if(s[Z](r)){if(i=s[r],!a.has(i))continue;switch(l=a.get(i),o=X(l),r){case"value":Rt(t,l);break;case"checked":case"disabled":t[r]=R===o?l:_(l)==t[ut];break;case"options":if("select"===t[lt]&&A===o){var c,f,d=l.length,h="",m=bt("optgroup",t);for(c=Ot(t),m=m.length?m[0]:t,bt("option",m).forEach(function(e){m.removeChild(e)}),f=0;d>f;f++)h+=l[f]&&l[f].label?'<option value="'+l[f].value+'">'+l[f].label+"</option>":'<option value="'+l[f]+'">'+l[f]+"</option>";m[dt]=h,Mt(t,c)}break;default:t[et](r,l)}}}},do_html:function(e,t,n){if(n.key){var r=this,i=r.$model,l=n.key;n.domRef&&(t=An.getDomRef(t,n.domRef)[0]),t&&l&&i.has(l)&&(t[n.text?mt in t?mt:ht:dt]=i.get(l))}},do_css:function(e,t,n){if(Q(n.css,I)){var r,i,l,o=this,u=o.$model,a=n.css;if(n.domRef&&(t=An.getDomRef(t,n.domRef)[0]),t)for(i in a)a[Z](i)&&(r=a[i],l=u.get(r),l&&(t.style[i]=l))}},do_set:function(e,t,n){var r,i=this,l=i.$model,o=null;n.key?o=n.key:t[it]&&(t[En]||(t[En]=l.key(t[it],1)),o=t[En]),o&&(n[Z]("value")?r=n.value:(n.domRef&&(t=An.getDomRef(t,n.domRef)[0]),r=Lt(t)),l.set(o,r,1))},do_tpl:function(e,t,n){var r,i,l,o=this,u=n.key,a=n.tpl;o.$template&&u&&a&&(n.domRef&&(t=An.getDomRef(t,n.domRef)[0]),t&&(r=o.$model,u&&r.has(u)&&(i=n.mode||"replace","replace"==i&&(t[dt]=""),l=o.$template(a,r.get(u)),l&&(t[dt]+=l))))},do_show:function(e,t,n){var r=this,i=r.$model,l=n.key;n.domRef&&(t=An.getDomRef(t,n.domRef)[0]),t&&l&&(n[Z]("value")?n.value===i.get(l)?xt(t):Ct(t):i.get(l)?xt(t):Ct(t))},do_hide:function(e,t,n){var r=this,i=r.$model,l=n.key;n.domRef&&(t=An.getDomRef(t,n.domRef)[0]),t&&l&&(n[Z]("value")?n.value===i.get(l)?Ct(t):xt(t):i.get(l)?Ct(t):xt(t))},do_bind:function(e,t,n){var r,i,l=this,o=(l.$model,n.name),u=n.key,a=t[ot].toLowerCase();if(u)if(r=n.value,i=X(r),"radio"===a)_(r)==t[ut]&&(l.get('input[name="'+o+'"]').forEach(function(e){t!==e&&(e[tt]=!1)}),t[tt]=!0);else if("checkbox"===a){var s=l.get('input[type="checkbox"][name="'+o+'"]');s.length>1&&A===i?s.forEach(function(e){e[tt]=-1<r.indexOf(e[ut])?!0:!1}):t[tt]=R===i?r:_(r)==t[ut]}else Rt(t,r)},toString:function(){return"[ModelView.View id: "+this.id+"]"}}),e.ModelView={VERSION:"0.60",UUID:Qt,Extend:Y,Type:on,Validation:un,Cache:en,Model:wn,Tpl:xn,View:An},!function(e,t){e.jquery=function(t){if(!t.ModelView){t.ModelView=e;var n=(Function.prototype.call.bind(Array.prototype.slice),t.extend),r=e.View,i=e.Model;t.fn.modelview=function(e,l){var o=arguments.length,u=o?e:null,a=e,s=!0,c=!1,f=[];return this.each(function(){var e,d,h,m,p=t(this);if(p.data("modelview")){if(s=!1,d=p.data("modelview"),e=d.$model,"view"===u)f.push(d);else if("model"===u){if(o>1)return d.model(l),this;f.push(e)}else if("data"===u){if(o>1)return e.data(l),this;f.push(e.data())}else"sync"===u?d.sync(l):"reset"===u?d.reset():"dispose"===u&&(p.data("modelview",null),d.dispose());return this}return c||(h={id:"model",data:{},types:{},validators:{},getters:{},setters:{},dependencies:{}},m={viewClass:r,modelClass:i,id:"view",bindAttribute:"data-bind",livebind:null,autobind:!1,bindbubble:!1,autovalidate:!0,events:null,autoSync:!0,cacheSize:r._CACHE_SIZE,refreshInterval:r._REFRESH_INTERVAL,model:null,template:null,actions:{},handlers:{},shortcuts:{}},a=n({},m,a),!a.model||a.model instanceof i||(a.model=n({},h,a.model)),c=!0),a.model?(e=a.model instanceof i?a.model:new a.modelClass(a.model.id,a.model.data,a.model.types,a.model.validators,a.model.getters,a.model.setters,a.model.dependencies),d=new a.viewClass(a.id,e,{bind:a.bindAttribute||"data-bind"},a.cacheSize,a.refreshInterval).template(a.template).events(a.handlers).shortcuts(a.shortcuts).actions(a.actions).livebind(a.livebind).autobind(a.autobind).bindbubble(a.bindbubble).autovalidate(a.autovalidate).bind(a.events,p[0]),p.data("modelview",d),void(a.autoSync&&d.sync())):this}),!s&&f.length?1==this.length?f[0]:f:this}}!t.widget||t.mvc&&t.mvc.ModelViewWidget||t.widget("mvc.ModelViewWidget",{options:{},$view:null,_create:function(){var e=this;e.$view=e.element.modelview(e.options).modelview("view")},value:function(e,t){var n=this;return 1<arguments.length?(n.$view.$model.set(e,t,1),n.element):n.$view.$model.get(e)},view:function(){return this.$view},model:function(){return this.$view.$model},_destroy:function(){var e=this.self.$view=null;e.element.modelview("dispose")}})},"undefined"!=typeof t.jQuery&&e.jquery(t.jQuery)}(e.ModelView,this),e.ModelView});